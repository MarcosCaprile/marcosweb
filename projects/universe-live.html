<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Universe Simulator (Full) · Marcos Caprile-Santos</title>
  <meta name="description" content="Universe Simulator (Full) – N-Body Visual Simulator (Velocity-Verlet), Sterne, Orbits, Zoom, Speed, Follow." />
  <link rel="canonical" href="https://marcos.caprile.net/projects/universe-live.html" />
  <meta name="robots" content="index, follow" />

  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/styles.css?v=999" />
</head>

<body>
  <!-- Topbar (immer sichtbar) -->
  <nav class="topbar visible" id="topbar">
    <div class="wrap nav-inner">
      <a class="logo" href="/#hero" aria-label="Home">MCS</a>

      <button class="menu-btn" id="menuBtn" aria-label="Menü öffnen" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <div class="nav-links" id="navLinks">
        <a href="/#about">Über mich</a>
        <a href="/#cv">Lebenslauf</a>

        <div class="dropdown" id="projectsDropdown">
          <button class="dropbtn" aria-expanded="false">
            Projekte <span class="chev"></span>
          </button>
          <div class="dropmenu" role="menu" aria-label="Projekte">
            <a href="/projects/studyconnect.html">StudyConnect</a>
            <a href="/projects/newton.html">N.E.W.T.O.N.</a>
            <a href="/projects/thoughtra.html">Thoughtra</a>
            <a href="/projects/impostor-games.html">Impostor Games</a>
            <a href="/projects/securescreen.html">SecureScreen SDK</a>
            <div class="dropsep"></div>
            <a href="/projects/universe.html">Universe Simulator (Showcase)</a>
            <a href="/projects/universe-live.html" aria-current="page">Universe Simulator (Full)</a>
          </div>
        </div>

        <a href="/#activities">Activities</a>
        <a href="/#qa">Fragebogen</a>
        <a href="/#social">Social</a>
        <a href="/#contact">Kontakt</a>
      </div>
    </div>
  </nav>

  <main class="wrap">
    <section class="card">
      <h2>Universe Simulator · Full Version</h2>
      <p class="muted">
        Browser-Umsetzung deines Python-Projekts: <b>N-Body</b> (Velocity-Verlet), Sterne, Orbits, Zoom, Speed, Follow.
      </p>
    </section>

    <section class="card reveal">
      <div class="universe">
        <div class="universe-top">
          <div class="universe-title">
            <h3 class="mini" style="margin:0">Interactive 3D Simulator</h3>
            <div class="universe-time" id="timeLabel">t = 0.00 Jahre (0 Tage)</div>
          </div>

          <div class="universe-controls">
            <label class="u-field">
              <span>Tage / Schritt</span>
              <input id="speed" type="range" min="0.1" max="50" step="0.1" value="1.0" />
              <b id="speedVal">1.0</b>
            </label>

            <label class="u-field">
              <span>Follow</span>
              <select id="follow">
                <option value="none">Keiner</option>
                <option value="Merkur">Merkur</option>
                <option value="Venus">Venus</option>
                <option value="Erde">Erde</option>
                <option value="Mond">Mond</option>
                <option value="ISS">ISS</option>
                <option value="GPS-1">GPS-1</option>
                <option value="Starlink-1">Starlink-1</option>
                <option value="Mars">Mars</option>
                <option value="Jupiter">Jupiter</option>
                <option value="Saturn">Saturn</option>
                <option value="Uranus">Uranus</option>
                <option value="Neptun">Neptun</option>
              </select>
            </label>

            <button class="u-btn" id="resetView" type="button">Reset View</button>
          </div>
        </div>

        <!-- WICHTIG: Diese Box bekommt feste Höhe per CSS -->
        <div class="universe-canvas" id="sceneWrap" aria-label="Universe Simulator Canvas"></div>

        <div class="universe-foot muted">
          <span>Drag = Rotate</span> · <span>Wheel = Zoom</span> · <span>Right click = Pan</span>
        </div>
      </div>
    </section>

    <section class="card reveal">
      <p class="fine"><a href="/projects/universe.html">← zurück zum Showcase</a></p>
    </section>
  </main>

  <footer class="wrap footer">
    <p>© <span id="y"></span> Marcos Caprile-Santos</p>
  </footer>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";

    // ===== Basics =====
    document.documentElement.classList.add("js");
    const y = document.getElementById("y"); if (y) y.textContent = new Date().getFullYear();

    // Mobile menu
    const menuBtn = document.getElementById("menuBtn");
    const navLinks = document.getElementById("navLinks");
    if (menuBtn && navLinks) {
      menuBtn.addEventListener("click", () => {
        const open = navLinks.classList.toggle("open");
        menuBtn.classList.toggle("open", open);
        menuBtn.setAttribute("aria-expanded", open ? "true" : "false");
      });
    }

    // Dropdown (mobile tap)
    const dd = document.getElementById("projectsDropdown");
    const ddBtn = dd ? dd.querySelector(".dropbtn") : null;
    if (dd && ddBtn) {
      ddBtn.addEventListener("click", (e) => {
        if (window.matchMedia("(max-width: 720px)").matches) {
          e.preventDefault();
          const open = dd.classList.toggle("open");
          ddBtn.setAttribute("aria-expanded", open ? "true" : "false");
        }
      });
    }

    // ===== UI =====
    const speed = document.getElementById("speed");
    const speedVal = document.getElementById("speedVal");
    const followSel = document.getElementById("follow");
    const timeLabel = document.getElementById("timeLabel");
    const resetBtn = document.getElementById("resetView");

    speed.addEventListener("input", () => speedVal.textContent = Number(speed.value).toFixed(1));

    // ===== N-Body Physics (wie dein Python: AU / Jahre / Sonnenmassen) =====
    const G = 4 * Math.PI * Math.PI;           // 4π²
    const DAY_IN_YEARS = 1 / 365.25;
    let simTime = 0;

    // helper: vector ops
    const v3 = (x=0,y=0,z=0)=>({x,y,z});
    const add = (a,b)=>v3(a.x+b.x,a.y+b.y,a.z+b.z);
    const sub = (a,b)=>v3(a.x-b.x,a.y-b.y,a.z-b.z);
    const mul = (a,k)=>v3(a.x*k,a.y*k,a.z*k);
    const len = (a)=>Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);

    class Body {
      constructor({name, mass, a=null, e=0, color=0xffffff, radiusKm=0, isSun=false}) {
        this.name=name;
        this.mass=mass;
        this.a=a; this.e=e;
        this.color=color;
        this.radiusKm=radiusKm;
        this.isSun=isSun;

        this.pos=v3(0,0,0);
        this.vel=v3(0,0,0);
        this.acc=v3(0,0,0);
      }
    }

    // Radien (km)
    const R_EARTH=6371.0;
    const AU_IN_KM=1.496e8;

    function markerSizeFromRadiusKm(rKm, isSun=false){
      if (!rKm || rKm<=0) return 0.25;
      const rel = rKm / R_EARTH;
      let size = 0.45 * Math.pow(rel, 0.3);
      if (isSun) size *= 1.6;
      return Math.min(1.25, Math.max(0.18, size));
    }

    // Bodies (Massen in Sonnenmassen, a,e wie im Python)
    const bodies = [];

    const sun = new Body({name:"Sonne", mass:1.0, a:null, e:0, color:0xffd24a, radiusKm:695700, isSun:true});
    bodies.push(sun);

    const defs = [
      {name:"Merkur",  mass:1.651e-7, a:0.387,  e:0.2056, color:0xa8a8a8, radiusKm:2439.7},
      {name:"Venus",   mass:2.447e-6, a:0.723,  e:0.0068, color:0xffa24a, radiusKm:6051.8},
      {name:"Erde",    mass:3.003e-6, a:1.000,  e:0.0167, color:0x3aa8ff, radiusKm:6371.0},
      {name:"Mars",    mass:3.227e-7, a:1.524,  e:0.0934, color:0xff3a2f, radiusKm:3389.5},
      {name:"Jupiter", mass:9.545e-4, a:5.203,  e:0.0489, color:0xd9a06a, radiusKm:69911},
      {name:"Saturn",  mass:2.858e-4, a:9.537,  e:0.0542, color:0xd7b05a, radiusKm:58232},
      {name:"Uranus",  mass:4.366e-5, a:19.191, e:0.0472, color:0x6fe7ff, radiusKm:25362},
      {name:"Neptun",  mass:5.151e-5, a:30.07,  e:0.0086, color:0x7a4dff, radiusKm:24622},
    ];

    for(const d of defs){
      const b = new Body(d);
      // Start im Perihel (wie Python)
      const rPeri = d.a * (1 - d.e);
      b.pos = v3(rPeri, 0, 0);
      const vPeri = Math.sqrt(G * (1 + d.e) / (d.a * (1 - d.e)));
      b.vel = v3(0, vPeri, 0);
      bodies.push(b);
    }

    // Earth ref
    const earth = bodies.find(b=>b.name==="Erde");

    // Mond wie Python (um Erde)
    const M_MOND = earth.mass * 0.0123;
    const moon = new Body({name:"Mond", mass:M_MOND, a:null, e:0, color:0xd0d0d0, radiusKm:1737.4});
    const rMoonAu = 384400.0 / AU_IN_KM;
    moon.pos = add(earth.pos, v3(rMoonAu,0,0));
    const GM_earth = G * earth.mass;
    const vMoonRel = Math.sqrt(GM_earth / rMoonAu);
    moon.vel = add(earth.vel, v3(0, vMoonRel, 0));
    bodies.push(moon);

    // Satelliten (extrem kleine Massen)
    const iss = new Body({name:"ISS", mass:2e-25, a:null, e:0, color:0xffffff, radiusKm:50});
    const gps = new Body({name:"GPS-1", mass:1e-26, a:null, e:0, color:0x46ff6a, radiusKm:50});
    const starlink = new Body({name:"Starlink-1", mass:1e-27, a:null, e:0, color:0x6fe7ff, radiusKm:40});

    const rIssAu = (R_EARTH + 420.0) / AU_IN_KM;
    const rGpsAu = (R_EARTH + 20200.0) / AU_IN_KM;
    const rSlAu  = (R_EARTH + 550.0) / AU_IN_KM;

    const vIssRel = Math.sqrt(GM_earth / rIssAu);
    const vGpsRel = Math.sqrt(GM_earth / rGpsAu);
    const vSlRel  = Math.sqrt(GM_earth / rSlAu);

    iss.pos = add(earth.pos, v3(rIssAu,0,0));
    iss.vel = add(earth.vel, v3(0, vIssRel, 0));

    gps.pos = add(earth.pos, v3(0,rGpsAu,0));
    gps.vel = add(earth.vel, v3(-vGpsRel, 0, 0));

    const inc = THREE.MathUtils.degToRad(53);
    starlink.pos = add(earth.pos, v3(rSlAu,0,0));
    starlink.vel = add(earth.vel, v3(0, vSlRel*Math.cos(inc), vSlRel*Math.sin(inc)));

    bodies.push(iss,gps,starlink);

    function computeAccelerations(){
      for(const b of bodies) b.acc = v3(0,0,0);
      for(let i=0;i<bodies.length;i++){
        const bi=bodies[i];
        for(let j=0;j<bodies.length;j++){
          if(i===j) continue;
          const bj=bodies[j];
          const d = sub(bj.pos, bi.pos);
          const r = len(d) + 1e-12;
          const factor = (G * bj.mass) / (r*r*r);
          bi.acc = add(bi.acc, mul(d, factor));
        }
      }
    }

    function velocityVerlet(dt){
      const axOld = bodies.map(b=>b.acc);
      // pos
      for(let i=0;i<bodies.length;i++){
        const b=bodies[i];
        b.pos = add(b.pos, add(mul(b.vel, dt), mul(axOld[i], 0.5*dt*dt)));
      }
      // new acc
      computeAccelerations();
      // vel
      for(let i=0;i<bodies.length;i++){
        const b=bodies[i];
        const aNew=b.acc;
        const aOld=axOld[i];
        b.vel = add(b.vel, mul(add(aOld,aNew), 0.5*dt));
      }
    }

    computeAccelerations();

    // ===== THREE Scene =====
    const wrap = document.getElementById("sceneWrap");
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);

    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:false });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(wrap.clientWidth, wrap.clientHeight);
    wrap.appendChild(renderer.domElement);

    const camera = new THREE.PerspectiveCamera(55, wrap.clientWidth / wrap.clientHeight, 0.01, 5000);
    camera.position.set(0, 18, 52);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.06;
    controls.minDistance = 6;
    controls.maxDistance = 260;

    const amb = new THREE.AmbientLight(0xffffff, 0.22);
    scene.add(amb);

    const sunLight = new THREE.PointLight(0xfff0c2, 2.0, 0, 1.2);
    sunLight.position.set(0,0,0);
    scene.add(sunLight);

    // Stars
    const starCount = 1400;
    const starGeo = new THREE.BufferGeometry();
    const starPos = new Float32Array(starCount*3);
    for(let i=0;i<starCount;i++){
      const r = 90 + Math.random()*70;
      const u = Math.random();
      const v = Math.random();
      const theta = 2*Math.PI*u;
      const phi = Math.acos(2*v - 1);
      starPos[i*3+0] = r*Math.sin(phi)*Math.cos(theta);
      starPos[i*3+1] = r*Math.cos(phi);
      starPos[i*3+2] = r*Math.sin(phi)*Math.sin(theta);
    }
    starGeo.setAttribute("position", new THREE.BufferAttribute(starPos,3));
    const starMat = new THREE.PointsMaterial({ color:0xffffff, size:0.6, transparent:true, opacity:0.55 });
    scene.add(new THREE.Points(starGeo, starMat));

    // Meshes
    const meshes = new Map();

    function makeSphere(color, radius, isSun=false){
      const geo = new THREE.SphereGeometry(radius, 32, 22);
      const mat = new THREE.MeshStandardMaterial({
        color,
        roughness: 0.7,
        metalness: 0.06,
        emissive: isSun ? new THREE.Color(0xffc85a) : new THREE.Color(0x000000),
        emissiveIntensity: isSun ? 0.55 : 0.0
      });
      return new THREE.Mesh(geo, mat);
    }

    for(const b of bodies){
      const r = markerSizeFromRadiusKm(b.radiusKm, b.isSun);
      const m = makeSphere(b.color, r, b.isSun);
      scene.add(m);
      meshes.set(b.name, m);
    }

    // Orbits (nur für Planeten mit a)
    function makeOrbit(a,e,color){
      const pts=[];
      const seg=500;
      for(let i=0;i<=seg;i++){
        const t = (i/seg)*Math.PI*2;
        const x = (a*Math.cos(t) - a*e);
        const y = (a*Math.sin(t)*Math.sqrt(1-e*e));
        pts.push(new THREE.Vector3(x, 0, y));
      }
      const geo = new THREE.BufferGeometry().setFromPoints(pts);
      const mat = new THREE.LineDashedMaterial({ color, dashSize:0.9, gapSize:0.55, transparent:true, opacity:0.30 });
      const line = new THREE.Line(geo, mat);
      line.computeLineDistances();
      return line;
    }

    for(const d of defs){
      scene.add(makeOrbit(d.a, d.e, d.color));
    }

    // ===== Follow =====
    let followName = "none";
    followSel.addEventListener("change", ()=> followName = followSel.value);

    function resetView(){
      followName="none";
      followSel.value="none";
      controls.target.set(0,0,0);
      camera.position.set(0,18,52);
      controls.update();
    }
    resetBtn.addEventListener("click", resetView);

    const updateTimeLabel = ()=>{
      const days = simTime*365.25;
      timeLabel.textContent = `t = ${simTime.toFixed(2)} Jahre (${Math.round(days)} Tage)`;
    };

    // ===== Animation Loop =====
    const clock = new THREE.Clock();

    function tick(){
      const dtReal = clock.getDelta(); // seconds
      const daysPerStep = Number(speed.value);

      // dt in YEARS: (daysPerStep * DAY_IN_YEARS) pro "step"
      // wir multiplizieren mit dtReal*30 damit es smooth + sichtbar ist (wie vorher)
      const dt = daysPerStep * DAY_IN_YEARS * (dtReal * 30);

      // physics step
      velocityVerlet(dt);
      simTime += dt;

      // update meshes
      for(const b of bodies){
        const m = meshes.get(b.name);
        // map python x,y,z -> three x,z,y (wir nehmen y als "height")
        m.position.set(b.pos.x, b.pos.z, b.pos.y);
      }

      // follow camera target
      if (followName !== "none" && meshes.has(followName)){
        const p = meshes.get(followName).position;
        controls.target.lerp(p, 0.08);
      }

      updateTimeLabel();
      controls.update();
      renderer.render(scene, camera);
      requestAnimationFrame(tick);
    }

    updateTimeLabel();
    tick();

    // Resize
    function onResize(){
      const w = wrap.clientWidth;
      const h = wrap.clientHeight;
      renderer.setSize(w,h);
      camera.aspect = w/h;
      camera.updateProjectionMatrix();
    }
    window.addEventListener("resize", onResize);
  </script>
</body>
</html>
